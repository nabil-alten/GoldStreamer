@using GoldStreamer.Helpers
@model IEnumerable<BLL.DomainClasses.NewsCategory>
@{ string baseUrl = CultureHelper.GetBaseURL().ToLower();
   string trClass = "clr_tr"; }

<script src="~/Scripts/GoldStreamer/ListFunctionsHelper.js"></script>

<br />
<table>
    <tr>
        <td>
            @Html.TextBox("txtSearch", ViewBag.GroupsSearchText as string, new { @placeholder = Resources.General.Search + "...", @class = "form-control search-query" })
    </td>

<td><div class="input-group absoluteInput form-search">
    <i id="btnSearch" class="btn btn-default" title="@Resources.General.Search" data-url="@baseUrl/NewsCategory/_List" data-container="divList" data-customparm="MainCategoryID|@Request.QueryString["MainCategoryID"]">@Resources.General.Search</i>
    @*<div id="searchValidator" style="color: red; display: none; text-align: center">@Resources.Messages.BasketNameLengthVal</div>*@
</div> </td>
    </tr>
</table>
<div class="title">
  

</div>

<table style="width:100%" class="data_table">
    @if (Model.Count() == 0)
    {
        <tr>
            <td colspan="3">
                @Html.Label("lblMSGsearch", Resources.Messages.NoData)
            </td>
        </tr>
    }

    else
    {
        <tr>
            <th>
                @Resources.General.NewsSubCategory
            </th>
            <th>
                @Resources.General.CategoryOrder
            </th>
            <th>
                @Resources.General.NewsMainCategory
            </th>
            <th> @Resources.General.Procedures</th>
        </tr>

        foreach (var item in Model)
        {
            <tr class='@trClass'>
                <td>
                    @Html.DisplayFor(modelItem => item.CategoryName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.CategoryOrder)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.MainCategory.MainCategoryName)

                </td>
                <td>
                    <a href="javascript:UpdateCategory(@item.Id);" title="@Resources.General.Edit"><img src="~/Content/Images/edit_1.png" width="30" /></a>
                    <a href="javascript:DeleteCategory(@item.Id);" title="@Resources.General.Delete"><img src="~/Content/Images/del.png" width="30"  /></a>

                </td>
            </tr>
            if (trClass == "")
            {
                trClass = "clr_tr";

            }
            else
            {
                trClass = "";

            }
        }
    }
</table>


<script>
    function querySt(Key) {
        var url = window.location.href;
        KeysValues = url.split(/[\?&]+/);
        for (i = 0; i < KeysValues.length; i++) {
            KeyValue = KeysValues[i].split("=");
            if (KeyValue[0] == Key) {
                return KeyValue[1];
            }
        }
    }

    var elementID;
    function UpdateCategory(id) {
        elementID = id;


        $.ajax({
            url: '@(baseUrl)/' + '/NewsCategory/GetCategoryInfo/',
            type: "POST",
            data: JSON.stringify({ 'id': id }),
            cache: false,
            contentType: "application/json; charset=utf-8",

            success: function (data) {
                debugger;
                var result = data.toString().split(",");
                document.getElementById('CategoryName').value = result[0].split(':')[1];
                document.getElementById('CategoryOrder').value = result[1].split(':')[1];
                $("#MainCategories").val(result[2].split(':')[1]);
            },
            error: function (data, xhr, textStatus) {
                toastr.error(textStatus);
            }
        });
    }


    function DeleteCategory(id) {
        var r = confirm("@Resources.Messages.SureDelete");

        if (r === true) {
            $.ajax({

                url: "@(baseUrl)/NewsCategory/Delete/" + id,
                type: 'Post',
                contentType: "application/json; charset=utf-8",

                success: function (data) {
                  
                    toastr.success('@Resources.Messages.Deleted');
                    var mainCategoryId = querySt('MainCategoryID');

                    $.ajax({
                        url: '@(baseUrl)/' + '/NewsCategory/_List/?MainCategoryID=' + mainCategoryId,
                        type: "POST",
                        success: function (data) {
                          
                            document.getElementById('CategoryName').value = '';
                            document.getElementById('CategoryOrder').value = '';
                            $("#MainCategories").val('1');
                            elementID = 0;
                            var x = navigator.userAgent.indexOf('CLR');//IE
                            if (x > 0) {
                                $('#divList').html(data);
                                $('#divList').show();
                            }
                            else
                                $('#divList').html(data);

                            $.ajax({
                                url: '@(baseUrl)/' + '/NewsCategory/_Save/',
                                type: "Get",
                                success: function (data) {
                                    $('#divResult').html(data);
                                  
                                }
                            });
                        }
                    });
                },
                error: function () {
                    toastr.error('@Resources.Messages.UnableToDelete');
                }
            });
        }
    }

</script>


